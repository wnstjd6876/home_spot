<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>지도 – HomeSpot</title>
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<style>
:root{--bg:#f7f8fb;--panel:#fff;--line:#e6e8ee;--text:#0f172a;--muted:#6b7280;--primary:#2563eb}
*{box-sizing:border-box}
body{margin:0;background:var(--bg);color:var(--text);font:14px/1.55 ui-sans-serif,system-ui,"Noto Sans KR",sans-serif}
header{position:sticky;top:0;z-index:10;background:#fff;border-bottom:1px solid var(--line)}
.wrap{max-width:1280px;margin:0 auto;padding:10px 14px;display:flex;gap:10px;align-items:center}
.brand{font-weight:800}
.search{flex:1;display:flex;gap:8px}
.search input{flex:1;padding:10px;border:1px solid var(--line);border-radius:10px}
.btn{padding:10px 12px;border:1px solid var(--line);border-radius:10px;background:#fff;cursor:pointer}
.btn.primary{background:var(--primary);color:#fff;border-color:transparent}
main{display:grid;grid-template-columns:70px 1fr;gap:10px;height:calc(100vh - 60px);max-width:1280px;margin:0 auto;padding:10px}
.side{background:#fff;border:1px solid var(--line);border-radius:12px;display:flex;flex-direction:column;align-items:center;padding:10px;gap:14px}
.side a{font-size:12px;color:#111;text-align:center}
#map{border:1px solid var(--line);border-radius:12px}
.topbar{position:absolute;left:90px;right:20px;top:76px;display:flex;gap:8px;z-index:5}
.chip{padding:10px 12px;border:1px solid var(--line);border-radius:999px;background:#fff;cursor:pointer}
.chip.active{background:#eef2ff;border-color:#c7d2fe}

/* 가격 핀(라벨) 마커 */
.price-pin{
  background:#2563eb;color:#fff;font-weight:700;border-radius:999px;
  padding:6px 10px;border:2px solid #fff;box-shadow:0 6px 18px rgba(0,0,0,.12);
  white-space:nowrap;transform:translate(-50%,-50%);
}
.price-pin.jeonse{background:#10b981}
.price-pin.rent{background:#f59e0b}
.price-pin.sale{background:#ef4444}
</style>
</head>
<body>
<header>
  <div class="wrap">
    <div class="brand">HomeSpot</div>
    <div class="search">
      <input id="q" placeholder="지역·지하철·키워드"/>
      <button class="btn primary" id="btnSearch">검색</button>
    </div>
    <button class="btn" onclick="location.href='tenant_favorites.html'">관심목록</button>
    <button class="btn" onclick="location.href='mainpagetenant.html'">메인</button>
  </div>
</header>

<main>
  <nav class="side">
    <a href="search_studio.html">원/투룸</a>
    <a href="search_apartment.html">아파트</a>
    <a href="search_office.html">오피스텔</a>
    <a href="search_villa.html">주택/빌라</a>
    <a href="search_bunyang.html">분양/입주</a>
  </nav>
  <div style="position:relative">
    <div class="topbar">
      <button class="chip" data-k="deal" data-v="rent">월세</button>
      <button class="chip" data-k="deal" data-v="jeonse">전세</button>
      <button class="chip" data-k="deal" data-v="sale">매매</button>
      <button class="chip" id="reset">초기화</button>
    </div>
    <div id="map" style="height:100%"></div>
  </div>
</main>

<script>
const STATE={q:'',deal:null};
let map, markers=[];
const DATA=[
  {id:1,type:'apartment',title:'마포 한강뷰',price:95000,area:84,lat:37.545,lng:126.94,deal:'sale',addr:'마포구'},
  {id:2,type:'studio',title:'연남 원룸',price:60,area:18,lat:37.562,lng:126.922,deal:'rent',addr:'마포구'},
  {id:3,type:'office',title:'여의도 오피스텔',price:150000,area:52,lat:37.523,lng:126.925,deal:'sale',addr:'영등포구'},
  {id:4,type:'villa',title:'성산동 빌라',price:85000,area:39,lat:37.563,lng:126.91,deal:'jeonse',addr:'마포구'},
];

const money=n=> n>=10000 ? (n/10000).toFixed(1)+'억' : (n+'만');

function makeIcon(d){
  const cls = d.deal ? `price-pin ${d.deal}` : 'price-pin';
  const label = d.deal==='rent' ? `월세 ${d.price}만`
              : d.deal==='jeonse' ? `전세 ${money(d.price)}`
              : d.deal==='sale' ? `${money(d.price)}`
              : `${money(d.price)}`;
  return L.divIcon({html:`<div class="${cls}">${label}</div>`, className:'', iconSize:[1,1]});
}

function render(){
  markers.forEach(m=>m.remove()); markers=[];
  const q=STATE.q.trim();
  let arr=DATA.filter(x=>!q || (`${x.title} ${x.addr}`).includes(q));
  if(STATE.deal) arr=arr.filter(x=>x.deal===STATE.deal);
  arr.forEach(d=>{
    const m=L.marker([d.lat,d.lng],{icon:makeIcon(d)}).addTo(map)
      .bindPopup(`<b>${d.title}</b><br>${d.addr}<br>${money(d.price)} · ${d.area}㎡`);
    markers.push(m);
  });
}

function boot(){
  map=L.map('map').setView([37.55,126.98],12);
  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{maxZoom:19}).addTo(map);

  document.querySelectorAll('.chip[data-k="deal"]').forEach(ch=>{
    ch.addEventListener('click',()=>{
      document.querySelectorAll('.chip[data-k="deal"].active').forEach(b=>b.classList.remove('active'));
      ch.classList.add('active'); STATE.deal=ch.dataset.v; render();
    });
  });
  document.getElementById('reset').onclick=()=>{STATE.deal=null;document.querySelectorAll('.chip').forEach(c=>c.classList.remove('active'));render();}
  document.getElementById('btnSearch').onclick=()=>{STATE.q=document.getElementById('q').value;render();}
  map.on('moveend',render);
  render();
}
boot();
</script>
</body>
</html>

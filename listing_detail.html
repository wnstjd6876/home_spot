<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>ë§¤ë¬¼ ìƒì„¸ | í™ˆìŠ¤íŒŸ</title>

<!-- Leaflet ì§€ë„ -->
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<!-- Chart.js (ì‹œì„¸ ê·¸ë˜í”„) -->
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>

<style>
:root{
  --bg:#f7f8fb; --panel:#fff; --line:#e6e8ee; --text:#0f172a; --muted:#64748b; --pri:#2563eb;
  --shadow:0 10px 30px rgba(17,24,39,.06);
}
*{box-sizing:border-box}
body{margin:0;background:var(--bg);color:var(--text);font:15px/1.6 ui-sans-serif,system-ui,"Noto Sans KR",sans-serif}
a{color:inherit;text-decoration:none}
.wrap{max-width:1200px;margin:0 auto;padding:16px 20px}
header{position:sticky;top:0;background:#fff;border-bottom:1px solid var(--line);z-index:20}
.header{display:flex;align-items:center;gap:12px;padding:12px 20px}
.brand{display:flex;align-items:center;gap:8px;font-weight:800}
.logo{width:26px;height:26px;border-radius:8px;background:linear-gradient(135deg,#2563eb,#8b5cf6)}
.right{margin-left:auto;display:flex;gap:8px}
.btn{padding:10px 14px;border:1px solid var(--line);border-radius:12px;background:#fff;cursor:pointer}
.btn:hover{transform:translateY(-1px);box-shadow:0 8px 22px rgba(0,0,0,.06)}
.btn.pri{background:var(--pri);border-color:transparent;color:#fff}
.badge{display:inline-flex;gap:6px;align-items:center;border:1px solid var(--line);border-radius:999px;padding:6px 10px;background:#fff}
.tag{padding:2px 8px;border-radius:999px;background:#eef2ff;font-size:12px}
.muted{color:var(--muted)}

.section{background:#fff;border:1px solid var(--line);border-radius:16px;box-shadow:var(--shadow);padding:16px}
.section-title{display:flex;align-items:center;justify-content:space-between;margin:0 0 10px}

/* ê°¤ëŸ¬ë¦¬ */
.gallery{display:grid;grid-template-columns:1fr 120px;gap:10px}
.mainimg{width:100%;height:420px;border-radius:12px;object-fit:cover;background:#e5e7eb}
.thumbs{display:flex;flex-direction:column;gap:10px;max-height:420px;overflow:auto}
.thumbs img{width:100%;height:80px;object-fit:cover;border-radius:10px;border:2px solid transparent;cursor:pointer}
.thumbs img.active{border-color:#2563eb}
.gallery-nav{display:flex;gap:8px;margin-top:8px}
.gallery-nav .btn{padding:8px 10px}

/* í•µì‹¬ ì •ë³´ */
.head{display:flex;gap:14px;align-items:flex-start;flex-wrap:wrap}
.head h1{margin:0}
.head .money{font-size:22px;font-weight:800}
.meta{display:flex;gap:8px;flex-wrap:wrap}

/* ì˜µì…˜ ì•„ì´ì½˜ */
.opts{display:flex;gap:10px;flex-wrap:wrap}
.opt{display:inline-flex;gap:6px;align-items:center;border:1px solid var(--line);border-radius:10px;background:#fff;padding:8px 10px}

/* ë ˆì´ì•„ì›ƒ */
.grid{display:grid;grid-template-columns:2fr 1fr;gap:16px}
@media (max-width:1024px){.grid{grid-template-columns:1fr}}
.card{background:#fff;border:1px solid var(--line);border-radius:16px;padding:16px;box-shadow:var(--shadow)}

/* ì§€ë„ */
#map{width:100%;height:340px;border-radius:12px}

/* ëª¨ë‹¬ */
.modal{position:fixed;inset:0;display:none;place-items:center;background:rgba(2,6,23,.36);z-index:50}
.modal.show{display:grid}
.sheet{background:#fff;border:1px solid var(--line);border-radius:16px;padding:16px;width:min(560px,92vw)}
.sheet .row{display:flex;gap:8px;margin:8px 0}
.sheet input,.sheet textarea{width:100%;padding:10px;border:1px solid var(--line);border-radius:10px}
.sheet textarea{min-height:100px;resize:vertical}
.sheet .footer{display:flex;gap:8px;justify-content:flex-end;margin-top:8px}
.danger{background:#ef4444;color:#fff;border-color:transparent}
</style>
</head>
<body>
<header>
  <div class="header wrap">
    <div class="brand"><div class="logo"></div>HomeSpot</div>
    <div class="right">
      <a class="btn" href="tenant_favorites.html">ê´€ì‹¬ëª©ë¡</a>
      <a class="btn" href="tenant_map.html">ì§€ë„</a>
      <a class="btn pri" href="login.html">ë¡œê·¸ì¸</a>
    </div>
  </div>
</header>

<main class="wrap">
  <!-- í•µì‹¬ ì •ë³´ í—¤ë” -->
  <section class="section">
    <div class="head">
      <div style="flex:1 1 420px">
        <h1 id="title">ë§ˆí¬ í•œê°•ë·° ì•„íŒŒíŠ¸</h1>
        <div class="meta">
          <span class="badge"><b id="deal">ì „ì„¸</b></span>
          <span class="badge">ìœ í˜•: <b id="type">ì•„íŒŒíŠ¸</b></span>
          <span class="badge">ë©´ì  <b id="area">84</b>ã¡</span>
          <span class="badge">ë°© <b id="rooms">3</b></span>
          <span class="badge">ì¸µ <b id="floor">18</b>/<b id="total">30</b></span>
        </div>
        <div class="muted" id="addr" style="margin-top:6px">ì„œìš¸ ë§ˆí¬êµ¬ ë§ì›ë™ 123-4</div>
      </div>
      <div style="display:flex;flex-direction:column;align-items:flex-end;gap:8px">
        <div class="money" id="price">9.5ì–µ</div>
        <div class="meta">
          <button id="btnFav" class="btn">â˜† ì°œí•˜ê¸°</button>
          <button id="btnContact" class="btn pri">ì¤‘ê°œì¸ ë¬¸ì˜</button>
          <button id="btnGuide" class="btn">ê°€ì´ë“œ</button>
        </div>
      </div>
    </div>
  </section>

  <div class="grid" style="margin-top:12px">
    <!-- ì¢Œ: ê°¤ëŸ¬ë¦¬ + ìƒì„¸/ì˜µì…˜ + ì§€ë„ + ê·¸ë˜í”„ -->
    <div style="display:flex;flex-direction:column;gap:12px">
      <section class="section">
        <h3 class="section-title" style="margin-bottom:8px">ì´ë¯¸ì§€ ê°¤ëŸ¬ë¦¬</h3>
        <div class="gallery">
          <img id="mainimg" class="mainimg" src="https://picsum.photos/seed/room1/1200/800" alt="">
          <div class="thumbs" id="thumbs"></div>
        </div>
        <div class="gallery-nav">
          <button class="btn" id="prev">â—€ ì´ì „</button>
          <button class="btn" id="next">ë‹¤ìŒ â–¶</button>
        </div>
      </section>

      <section class="section">
        <div class="section-title"><h3 style="margin:0">í•µì‹¬ ì •ë³´</h3><span class="tag">ìƒì„¸ì„¤ëª…</span></div>
        <div id="desc" class="muted">
          íƒ íŠ¸ì¸ í•œê°• ì¡°ë§ê³¼ í’ë¶€í•œ ì±„ê´‘, ëŒ€ë‹¨ì§€ ì»¤ë®¤ë‹ˆí‹°(í”¼íŠ¸ë‹ˆìŠ¤, ê²ŒìŠ¤íŠ¸ë£¸, í‚¤ì¦ˆì¹´í˜).  
          ë„ë³´ 5ë¶„ ë‚´ í¸ì˜ì‹œì„¤ í’ë¶€ / ì´ˆì¤‘ê³  ë„ë³´ê¶Œ / ë°˜ë ¤ë™ë¬¼ ì‚°ì±…ë¡œ ì¸ì ‘.
        </div>
        <hr style="margin:12px 0;border:none;border-top:1px dashed var(--line)"/>
        <div><b>ì˜µì…˜</b></div>
        <div class="opts" id="opts"></div>
      </section>

      <section class="section">
        <div class="section-title"><h3 style="margin:0">ìœ„ì¹˜/ì£¼ë³€</h3><span class="tag">ì§€í•˜ì² /í•™êµ/ìƒê¶Œ</span></div>
        <div id="map"></div>
      </section>

      <section class="section">
        <div class="section-title"><h3 style="margin:0">ê°€ê²© ë³€ë™ ì¶”ì´</h3><span class="tag">ì‹œì„¸ ê·¸ë˜í”„</span></div>
        <canvas id="chart" height="120"></canvas>
        <div class="muted" style="margin-top:6px">â€» ì‹¤ì œ ë°ì´í„° ì—°ë™ ì§€ì : <code>/api/price-history?listingId=...</code></div>
      </section>
    </div>

    <!-- ìš°: ì¤‘ê°œì¸ ì¹´ë“œ/ì•ˆë‚´ -->
    <aside style="display:flex;flex-direction:column;gap:12px">
      <div class="card">
        <div class="section-title"><h3 style="margin:0">ì¤‘ê°œì‚¬ ì •ë³´</h3><span class="tag">ê³µì¸ì¤‘ê°œì‚¬</span></div>
        <div style="display:flex;gap:10px;align-items:center">
          <img src="https://i.pravatar.cc/80?img=12" style="width:64px;height:64px;border-radius:50%">
          <div>
            <div><b id="agentName">ë°•ì¤‘ê°œ</b> <span class="muted">(í™ˆìŠ¤íŒŸ ê³µì¸ì¤‘ê°œì‚¬)</span></div>
            <div class="muted">ğŸ“ <span id="agentPhone">02-123-4567</span></div>
            <div class="muted">ğŸ¢ <span id="agentOffice">ë§ˆí¬í™ˆìŠ¤íŒŸì¤‘ê°œì‚¬ë¬´ì†Œ</span></div>
          </div>
        </div>
        <button class="btn pri" id="btnContact2" style="margin-top:10px;width:100%">ë¬¸ì˜í•˜ê¸°</button>
      </div>

      <div class="card">
        <div class="section-title"><h3 style="margin:0">ì•ˆì „ ê°€ì´ë“œ</h3><span class="tag">ì²´í¬ë¦¬ìŠ¤íŠ¸</span></div>
        <div class="muted">ê³„ì•½ ì „ í•„ìˆ˜ í™•ì¸ì‚¬í•­ê³¼ ì „ì„¸ì‚¬ê¸° ë°©ì§€ íŒì„ í™•ì¸í•˜ì„¸ìš”.</div>
        <button class="btn" id="btnGuide2" style="margin-top:10px;width:100%">ê°€ì´ë“œ ì—´ê¸°</button>
      </div>
    </aside>
  </div>
</main>

<!-- ë¬¸ì˜ ëª¨ë‹¬ -->
<div class="modal" id="modalContact">
  <div class="sheet">
    <div style="display:flex;justify-content:space-between;align-items:center">
      <h3 style="margin:0">ì¤‘ê°œì¸ ë¬¸ì˜</h3>
      <button class="btn danger" onclick="toggleModal('modalContact',false)">ë‹«ê¸°</button>
    </div>
    <form id="contactForm" onsubmit="sendInquiry(event)">
      <div class="row">
        <input name="name" placeholder="ì´ë¦„" required>
        <input name="phone" placeholder="ì—°ë½ì²˜(ìˆ«ìë§Œ)" pattern="[0-9]+" required>
      </div>
      <input name="time" placeholder="í†µí™” ê°€ëŠ¥ ì‹œê°„ (ì˜ˆ: í‰ì¼ ì €ë…)">
      <textarea name="msg" placeholder="ë¬¸ì˜ ë‚´ìš©ì„ ì‘ì„±í•˜ì„¸ìš”." required></textarea>
      <div class="footer">
        <button type="button" class="btn" onclick="toggleModal('modalContact',false)">ë‹«ê¸°</button>
        <button type="submit" class="btn pri">ë¬¸ì˜ ë³´ë‚´ê¸°</button>
      </div>
    </form>
    <div class="muted" style="margin-top:8px">â€» ì‹¤ì œ ì „ì†¡ ì§€ì : <code>POST /api/inquiries</code></div>
  </div>
</div>

<!-- ê°€ì´ë“œ ëª¨ë‹¬ -->
<div class="modal" id="modalGuide">
  <div class="sheet">
    <div style="display:flex;justify-content:space-between;align-items:center">
      <h3 style="margin:0">ê³„ì•½/ì•ˆì „ ê°€ì´ë“œ</h3>
      <button class="btn danger" onclick="toggleModal('modalGuide',false)">ë‹«ê¸°</button>
    </div>
    <ul style="margin:10px 0 0 18px">
      <li>ë“±ê¸°ë¶€ë“±ë³¸ìƒ ì†Œìœ ìì™€ ê³„ì•½ ìƒëŒ€ê°€ ì¼ì¹˜í•˜ëŠ”ì§€ í™•ì¸</li>
      <li>ì „ì…ì‹ ê³ /í™•ì •ì¼ì ê°€ëŠ¥ ì—¬ë¶€ ë° ì„ ìˆœìœ„ê¶Œë¦¬ í™•ì¸</li>
      <li>ë³´ì¦ê¸ˆ ë°˜í™˜ ë³´ì¦ ê°€ì… ê°€ëŠ¥ ì—¬ë¶€ í™•ì¸</li>
      <li>ê³„ì•½ê¸ˆ/ì”ê¸ˆ ì´ì²´ëŠ” ê°€ê¸‰ì  ì—ìŠ¤í¬ë¡œ/ì•ˆì‹¬ê³„ì¢Œ ì‚¬ìš©</li>
      <li>ì£¼ë³€ ì‹œì„¸/ì‹¤ê±°ë˜ê°€ ë¹„êµ í›„ ê³¼ë„í•œ ì‹œì„¸ëŠ” ì£¼ì˜</li>
    </ul>
    <div class="footer">
      <button class="btn" onclick="toggleModal('modalGuide',false)">í™•ì¸</button>
    </div>
  </div>
</div>

<script>
/* --------------------------- ë”ë¯¸ ë°ì´í„° --------------------------- */
const DETAIL = {
  id: 'L-2025-0001',
  title:'ë§ˆí¬ í•œê°•ë·° ì•„íŒŒíŠ¸',
  deal :'ì „ì„¸', type:'ì•„íŒŒíŠ¸', price: 95000,  // ë§Œì›
  area:84, rooms:3, floor:18, total:30,
  addr:'ì„œìš¸ ë§ˆí¬êµ¬ ë§ì›ë™ 123-4',
  lat:37.5559, lng:126.9104,
  desc:'íƒ íŠ¸ì¸ í•œê°• ì¡°ë§ê³¼ í’ë¶€í•œ ì±„ê´‘, ëŒ€ë‹¨ì§€ ì»¤ë®¤ë‹ˆí‹°(í”¼íŠ¸ë‹ˆìŠ¤, ê²ŒìŠ¤íŠ¸ë£¸, í‚¤ì¦ˆì¹´í˜). ë„ë³´ 5ë¶„ ë‚´ í¸ì˜ì‹œì„¤ í’ë¶€ / ì´ˆì¤‘ê³  ë„ë³´ê¶Œ / ë°˜ë ¤ë™ë¬¼ ì‚°ì±…ë¡œ ì¸ì ‘.',
  options:['ì—˜ë¦¬ë² ì´í„°','ì£¼ì°¨','ë°˜ë ¤ë™ë¬¼','í’€ì˜µì…˜'],
  images:[
    'https://picsum.photos/seed/room1/1200/800',
    'https://picsum.photos/seed/room2/1200/800',
    'https://picsum.photos/seed/room3/1200/800',
    'https://picsum.photos/seed/room4/1200/800',
    'https://picsum.photos/seed/room5/1200/800'
  ],
  agent:{name:'ë°•ì¤‘ê°œ', phone:'02-123-4567', office:'ë§ˆí¬í™ˆìŠ¤íŒŸì¤‘ê°œì‚¬ë¬´ì†Œ'}
};
// â€» ì‹¤ì œ í™˜ê²½: URL íŒŒë¼ë¯¸í„° idë¡œ ì¡°íšŒ â†’ fetch(`/api/listings/${id}`)

/* --------------------------- ìœ í‹¸ --------------------------- */
const $=s=>document.querySelector(s);
const moneyKR = m => (m>=10000? (m/10000).toFixed(1)+'ì–µ' : m+'ë§Œ');

/* --------------------------- ë Œë” --------------------------- */
function render(){
  $('#title').textContent=DETAIL.title;
  $('#deal').textContent=DETAIL.deal;
  $('#type').textContent=DETAIL.type;
  $('#price').textContent=moneyKR(DETAIL.price);
  $('#area').textContent=DETAIL.area;
  $('#rooms').textContent=DETAIL.rooms;
  $('#floor').textContent=DETAIL.floor;
  $('#total').textContent=DETAIL.total;
  $('#addr').textContent=DETAIL.addr;
  $('#desc').textContent=DETAIL.desc;
  $('#agentName').textContent=DETAIL.agent.name;
  $('#agentPhone').textContent=DETAIL.agent.phone;
  $('#agentOffice').textContent=DETAIL.agent.office;

  // ì˜µì…˜
  $('#opts').innerHTML = DETAIL.options.map(v=>`<span class="opt">âœ… ${v}</span>`).join('');

  // ê°¤ëŸ¬ë¦¬
  const main = $('#mainimg');
  const thumbs = $('#thumbs');
  main.src = DETAIL.images[0];
  thumbs.innerHTML = DETAIL.images.map((src,i)=>`<img data-idx="${i}" src="${src}" class="${i===0?'active':''}">`).join('');
  thumbs.querySelectorAll('img').forEach(img=>{
    img.onclick = ()=>setMain(Number(img.dataset.idx));
  });

  // ë„¤ë¹„
  $('#prev').onclick = ()=> nav(-1);
  $('#next').onclick = ()=> nav(+1);

  // ì§€ë„
  initMap();

  // ê·¸ë˜í”„(ë”ë¯¸ ì‹œê³„ì—´)
  initChart();
}
function setMain(i){
  const main = $('#mainimg'); main.src = DETAIL.images[i];
  $('#thumbs').querySelectorAll('img').forEach((t,idx)=>t.classList.toggle('active',idx===i));
  main.dataset.idx = i;
}
function nav(d){
  const i = Number($('#mainimg').dataset.idx||0);
  const n = (i + d + DETAIL.images.length) % DETAIL.images.length;
  setMain(n);
}

/* --------------------------- ì§€ë„ --------------------------- */
let map;
function initMap(){
  map = L.map('map',{scrollWheelZoom:false}).setView([DETAIL.lat, DETAIL.lng], 15);
  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{attribution:'Â© OpenStreetMap'}).addTo(map);
  L.marker([DETAIL.lat,DETAIL.lng]).addTo(map).bindPopup(DETAIL.title);
}

/* --------------------------- ì‹œì„¸ ê·¸ë˜í”„ --------------------------- */
function initChart(){
  const ctx = document.getElementById('chart');
  // ë”ë¯¸ ë°ì´í„° (ìµœê·¼ 12ê°œì›”)
  const labels = Array.from({length:12}).map((_,i)=>`${i+1}ê°œì›” ì „`).reverse();
  const values = Array.from({length:12}).map((_,i)=> 7.8 + Math.sin(i/2)*0.4 + (i*0.03) ); // ì–µ ë‹¨ìœ„
  new Chart(ctx,{
    type:'line',
    data:{
      labels,
      datasets:[{
        label:'ì‹¤ê±°ë˜ê°€(ì–µ)',
        data:values,
        borderColor:'#2563eb',
        tension:.3
      }]
    },
    options:{
      scales:{y:{ticks:{callback:v=>v+'ì–µ'}}},
      plugins:{legend:{display:false}}
    }
  });
}

/* --------------------------- ì°œ(ì¦ê²¨ì°¾ê¸°) --------------------------- */
const FAV_KEY='hs:favs';
function isFav(id){ try{ return JSON.parse(localStorage.getItem(FAV_KEY)||'[]').includes(id); }catch{return false} }
function toggleFav(){
  const id = DETAIL.id;
  let arr = [];
  try{arr = JSON.parse(localStorage.getItem(FAV_KEY)||'[]')}catch{}
  if(arr.includes(id)) arr = arr.filter(x=>x!==id);
  else arr.push(id);
  localStorage.setItem(FAV_KEY, JSON.stringify(arr));
  paintFavButton();
}
function paintFavButton(){
  const f = isFav(DETAIL.id);
  const btn = $('#btnFav');
  btn.textContent = f ? 'â˜… ì°œë¨' : 'â˜† ì°œí•˜ê¸°';
}
$('#btnFav').onclick=toggleFav;

/* --------------------------- ë¬¸ì˜/ê°€ì´ë“œ ëª¨ë‹¬ --------------------------- */
function toggleModal(id, show){
  const el = document.getElementById(id);
  if(show===undefined) el.classList.toggle('show');
  else el.classList.toggle('show',show);
}
['btnContact','btnContact2'].forEach(id=>document.getElementById(id).onclick=()=>toggleModal('modalContact', true));
['btnGuide','btnGuide2'].forEach(id=>document.getElementById(id).onclick=()=>toggleModal('modalGuide', true));
window.addEventListener('keydown',e=>{
  if(e.key==='Escape'){ toggleModal('modalContact',false); toggleModal('modalGuide',false); }
});
document.querySelectorAll('.modal').forEach(m=>{
  m.addEventListener('click',e=>{ if(e.target===m) m.classList.remove('show'); });
});

/* --------------------------- ë¬¸ì˜ ì „ì†¡(ë”ë¯¸) --------------------------- */
function sendInquiry(e){
  e.preventDefault();
  const data = Object.fromEntries(new FormData(e.target).entries());
  // ì‹¤ì œ ì „ì†¡: fetch('/api/inquiries',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({...data, listingId: DETAIL.id})})
  alert('ë¬¸ì˜ê°€ ì ‘ìˆ˜ë˜ì—ˆìŠµë‹ˆë‹¤. (ë”ë¯¸)\n\nì´ë¦„: '+data.name+'\nì—°ë½ì²˜: '+data.phone+'\ní¬ë§ì‹œê°„: '+(data.time||'')+'\në‚´ìš©: '+data.msg);
  e.target.reset();
  toggleModal('modalContact', false);
}

/* --------------------------- ì‹œì‘ --------------------------- */
render();
paintFavButton();
</script>
</body>
</html>

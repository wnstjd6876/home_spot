<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>매물 등록</title>
  <link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet" />
  <style>
    :root {
      --bg: #f5f7fb;
      --card: #ffffff;
      --text: #0f172a;
      --muted: #64748b;
      --border: #e5e7eb;
      --accent: #2563eb;
      --accent-weak: #e8f0ff;
      --ring: 0 0 0 4px rgba(37, 99, 235, .15);
      --radius: 14px;
      --shadow: 0 10px 30px rgba(2, 6, 23, .1);
      --neutral: #d1d5db;
      --neutral-weak: #f3f4f6;
      --neutral-text: #374151;
      --font: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
    }
    @media (prefers-color-scheme: dark) {
      :root {
        --bg: #0b1220;
        --card: #0f172a;
        --text: #e2e8f0;
        --muted: #94a3b8;
        --border: #1e293b;
        --accent: #60a5fa;
        --accent-weak: #0b2a64;
        --ring: 0 0 0 4px rgba(96, 165, 250, .2);
        --shadow: 0 10px 30px rgba(0, 0, 0, .5);
        --neutral: #334155;
        --neutral-weak: #0f172a;
        --neutral-text: #cbd5e1;
      }
    }
    * { box-sizing: border-box; }
    html, body { margin: 0; padding: 0; height: 100%; }
    html { scroll-padding-top: 80px; }
    body {
      display: block;
      overflow-y: auto;
      padding: clamp(16px, 3vw, 32px);
      background:
        radial-gradient(1200px 600px at 10% -10%, rgba(37, 99, 235, .08), transparent 40%),
        radial-gradient(1000px 600px at 90% 110%, rgba(99, 102, 241, .06), transparent 40%),
        var(--bg);
      font-family: var(--font);
      color: var(--text);
      line-height: 1.6;
    }
    .form-shell { width: 100%; max-width: 820px; margin: 0 auto; }
    .app-title {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 10px;
      font-weight: 800;
      font-size: clamp(22px, 2vw, 28px);
      letter-spacing: -.02em;
      margin: 0 0 16px;
    }
    .app-title .dot {
      width: 10px;
      height: 10px;
      border-radius: 50%;
      background: linear-gradient(135deg, var(--accent), #8b5cf6);
    }
    .form-container {
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding: clamp(18px, 3vw, 28px);
    }
    form {
      display: grid;
      gap: 16px;
      grid-template-columns: 1fr;
    }
    @media (min-width: 860px) {
      form { grid-template-columns: 1fr 1fr; }
      .field--full { grid-column: 1 / -1; }
    }
    .field { display: grid; gap: 8px; scroll-margin-top: 80px; }
    label { font-size: 14px; font-weight: 600; letter-spacing: -.01em; }
    .req { color: var(--accent); margin-left: 4px; font-weight: 800; }
    .hint { font-size: 12px; color: var(--muted); margin-top: -2px; }
    input, .ql-container {
      width: 100%;
      border: 1px solid var(--border);
      background: color-mix(in oklab, var(--card) 90%, #fff 10%);
      color: var(--text);
      border-radius: 12px;
      padding: 12px 14px;
      font-size: 16px;
      line-height: 1.5;
      height: 44px;
      transition: border-color .2s, box-shadow .2s, transform .03s;
      outline: none;
    }
    input:hover, .ql-container:hover { border-color: color-mix(in oklab, var(--accent) 35%, var(--border) 65%); }
    input:focus, .ql-container.ql-focused { border-color: var(--accent); box-shadow: var(--ring); }
    input[type="number"]::-webkit-outer-spin-button,
    input[type="number"]::-webkit-inner-spin-button { -webkit-appearance: none; margin: 0; }
    input[type="number"] { -moz-appearance: textfield; }
    #description { height: 260px; }
    .ql-toolbar {
      border: 1px solid var(--border) !important;
      border-bottom: none !important;
      border-radius: 12px 12px 0 0 !important;
      background: color-mix(in oklab, var(--card) 85%, #fff 15%) !important;
    }
    .ql-container.ql-snow {
      border: 1px solid var(--border) !important;
      border-radius: 0 0 12px 12px !important;
    }
    .ql-container { padding: 0 !important; }
    .ql-editor {
      min-height: 200px;
      font-size: 16px;
      line-height: 1.7;
      padding: 12px 14px !important;
      text-align: left;
    }
    .ql-editor.ql-blank::before {
      color: var(--muted) !important;
      font-style: normal !important;
      font-size: 14px !important;
      white-space: pre-line;
    }
    .ql-editor.ql-blank:focus::before {
      content: "" !important;
      opacity: 0 !important;
    }
    .actions {
      display: grid;
      gap: 12px;
      grid-template-columns: 1fr;
    }
    @media (min-width: 860px) {
      .actions { grid-column: 1 / -1; grid-template-columns: 1fr 1fr; }
    }
    .actions > .btn { flex: 1; width: 100%; }
    .btn {
      appearance: none;
      border: none;
      border-radius: 12px;
      padding: 14px 16px;
      font-weight: 600;
      letter-spacing: .2px;
      cursor: pointer;
      transition: transform .05s, box-shadow .2s, background-color .2s;
    }
    .btn:active { transform: translateY(1px); }
    .btn-primary { background: #E0E0E0; color: #000; font-weight: 500; }
    .btn-primary:hover { background: #D6D6D6; }
    .btn-ghost {
      background: var(--neutral-weak);
      color: var(--neutral-text);
      border: 1px solid var(--neutral);
    }
    .btn-ghost:hover {
      background: color-mix(in oklab, var(--neutral-weak) 70%, #fff 30%);
    }
    .badge {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      font-size: 12px;
      color: var(--muted);
      background: color-mix(in oklab, var(--card) 85%, #fff 15%);
      border: 1px solid var(--border);
      padding: 6px 10px;
      border-radius: 999px;
    }
    .badge .dot {
      width: 6px;
      height: 6px;
      border-radius: 50%;
      background: var(--accent);
    }
    .segmented {
      display: flex;
      flex-wrap: nowrap;
      gap: 6px;
      justify-content: space-between;
    }
    .seg-btn {
      flex: 1;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      white-space: nowrap;
      gap: 8px;
      border: 1px solid var(--border);
      background: color-mix(in oklab, var(--card) 85%, #fff 15%);
      color: var(--text);
      padding: 10px 14px;
      border-radius: 999px;
      font-size: 14px;
      font-weight: 600;
      letter-spacing: .1px;
      cursor: pointer;
      user-select: none;
      transition: border-color .2s, box-shadow .2s, transform .03s;
    }
    .seg-btn svg { width: 16px; height: 16px; opacity: .9; }
    .seg-btn:hover { border-color: color-mix(in oklab, var(--accent) 35%, var(--border) 65%); }
    .seg-btn[aria-checked="true"] {
      background: color-mix(in oklab, var(--accent) 15%, var(--card));
      border-color: var(--accent);
      box-shadow: var(--ring);
    }
    .seg-btn:focus-visible { outline: none; box-shadow: var(--ring); }
    .hidden-select {
      position: absolute !important;
      opacity: 0 !important;
      width: 0 !important;
      height: 0 !important;
      pointer-events: none !important;
    }
    .uploader {
      display: flex;
      gap: 8px;
      align-items: center;
      margin-top: 6px;
    }
    .file-btn { position: relative; overflow: hidden; }
    .file-btn input {
      position: absolute;
      inset: 0;
      opacity: 0;
      cursor: pointer;
    }
    .file-label { font-size: 13px; color: var(--muted); }
    .hidden { display: none; }
  </style>
</head>
<body>
  <div class="form-shell">
    <h1 class="app-title">매물 등록</h1>
    <div class="form-container">
      <form onsubmit="handleSubmit(event)" novalidate>
        <div class="field field--full">
          <label for="buildingName">건물 명 <span class="req">*</span></label>
          <input type="text" id="buildingName" name="buildingName" placeholder="예) 더블루 아파트 101동" />
          <div class="hint">도로명/동·호수까지 정확히 입력하면 지도 매칭이 쉬워요.</div>
        </div>

        <div class="field field--full">
          <label id="buildingTypeLabel" for="buildingType">건물 종류 <span class="req">*</span></label>
          <select id="buildingType" name="buildingType" class="hidden-select">
            <option value="">선택하세요</option>
            <option value="apartment">아파트</option>
            <option value="officetel">오피스텔</option>
            <option value="house">주택</option>
            <option value="villa">빌라</option>
            <option value="new">분양/입주</option>
          </select>
          <div class="segmented" role="radiogroup" aria-labelledby="buildingTypeLabel">
            <button type="button" class="seg-btn" role="radio" aria-checked="false" data-value="apartment">아파트</button>
            <button type="button" class="seg-btn" role="radio" aria-checked="false" data-value="officetel">오피스텔</button>
            <button type="button" class="seg-btn" role="radio" aria-checked="false" data-value="house">주택</button>
            <button type="button" class="seg-btn" role="radio" aria-checked="false" data-value="villa">빌라</button>
            <button type="button" class="seg-btn" role="radio" aria-checked="false" data-value="new">분양/입주</button>
          </div>
        </div>

        <div id="yearField" class="field hidden">
          <label for="buildYear">건물 년도</label>
          <input type="number" id="buildYear" name="buildYear" min="1900" placeholder="예) 2008" />
          <div class="hint">연도만 입력 (1900 ~ 현재 연도)</div>
        </div>

        <div id="dealTypeField" class="field field--full hidden">
          <label id="dealTypeLabel" for="dealType">거래 유형 <span class="req">*</span></label>
          <select id="dealType" name="dealType" class="hidden-select">
            <option value="">선택하세요</option>
            <option value="monthly">월세</option>
            <option value="jeonse">전세</option>
            <option value="sale">매매</option>
            <option value="yearly">연세</option>
          </select>
          <div class="segmented" role="radiogroup" aria-labelledby="dealTypeLabel">
            <button type="button" class="seg-btn" role="radio" aria-checked="false" data-value="monthly">월세</button>
            <button type="button" class="seg-btn" role="radio" aria-checked="false" data-value="jeonse">전세</button>
            <button type="button" class="seg-btn" role="radio" aria-checked="false" data-value="sale">매매</button>
            <button type="button" class="seg-btn" role="radio" aria-checked="false" data-value="yearly">연세</button>
          </div>
        </div>

        <div id="priceField" class="field field--full hidden">
          <label for="price">가격 (만원) <span class="req">*</span></label>
          <input type="number" id="price" name="price" min="0" placeholder="예) 45000" />
        <div class="hint">숫자만 입력 (예: 4억 5천 → 45000)</div>
        </div>

        <div id="sizeField" class="field field--full hidden">
          <label for="size">평수 (평) <span class="req">*</span></label>
          <input type="number" id="size" name="size" min="0" step="0.1" placeholder="예) 24.5" />
          <div class="hint">소수점 한 자리까지 입력 가능</div>
        </div>

        <div id="exclusiveAreaField" class="field field--full hidden">
          <label for="exclusiveArea">전용 면적 (㎡) <span class="req">*</span></label>
          <input type="number" id="exclusiveArea" name="exclusiveArea" min="0" step="0.1" placeholder="예) 59.84" />
        </div>

        <div id="grossAreaField" class="field field--full hidden">
          <label for="grossArea">연면적 (㎡) <span class="req">*</span></label>
          <input type="number" id="grossArea" name="grossArea" min="0" step="0.1" placeholder="예) 84.97" />
        </div>

        <div id="landAreaField" class="field field--full hidden">
          <label for="landArea">대지 면적 (㎡) <span class="req">*</span></label>
          <input type="number" id="landArea" name="landArea" min="0" step="0.1" placeholder="예) 102.34" />
        </div>

        <div id="landRightAreaField" class="field field--full hidden">
          <label for="landRightArea">대지권 면적 (㎡) <span class="req">*</span></label>
          <input type="number" id="landRightArea" name="landRightArea" min="0" step="0.1" placeholder="예) 45.12" />
        </div>

        <div id="floorField" class="field field--full hidden">
          <label for="floor">층수 (n층) <span class="req">*</span></label>
          <input type="number" id="floor" name="floor" step="1" placeholder="예) -1, 12" />
        </div>

        <div class="field field--full">
          <label for="description">건물에 대한 설명 (텍스트 + 이미지) <span class="req">*</span></label>
          <div class="badge"><span class="dot"></span> PNG/JPG 붙여넣기 가능 · 링크 첨부 지원</div>
          <div class="uploader">
            <div class="btn btn-ghost file-btn">
              <input type="file" id="imagePicker" accept="image/*" multiple />
              <span>사진 선택</span>
            </div>
            <span class="file-label">여러 장 선택 가능</span>
          </div>
          <div id="description"></div>
        </div>

        <input type="hidden" name="descriptionContent" id="descriptionContent" />

        <div class="actions">
          <button type="submit" class="btn btn-primary">등록하기</button>
          <button type="reset" class="btn btn-ghost" onclick="resetForm()">초기화</button>
        </div>
      </form>
    </div>
  </div>

  <script src="https://cdn.quilljs.com/1.3.6/quill.js"></script>
  <script>
    const quill = new Quill('#description', {
      theme: 'snow',
      placeholder: '건물 특징, 옵션(엘리베이터/주차/반려동물), 주변 편의시설 등을 적고, 사진을 드래그-드롭/붙여넣기 또는 선택하여 추가하세요.',
      modules: {
        toolbar: [
          [{ header: [2, 3, false] }],
          ['bold', 'italic', 'underline'],
          [{ list: 'ordered' }, { list: 'bullet' }],
          ['link', 'image', 'clean']
        ]
      }
    });
    setTimeout(() => {
      quill.focus();
      quill.setSelection(0, 0);
    }, 0);

    const hiddenSelect = document.getElementById('buildingType');
    const segButtons = Array.from(document.querySelectorAll('[aria-labelledby="buildingTypeLabel"] .seg-btn'));
    const dealSelect = document.getElementById('dealType');
    const dealButtons = Array.from(document.querySelectorAll('[aria-labelledby="dealTypeLabel"] .seg-btn'));
    const priceField = document.getElementById('priceField');
    const sizeField = document.getElementById('sizeField');
    const dealTypeField = document.getElementById('dealTypeField');
    const yearField = document.getElementById('yearField');
    const priceInput = document.getElementById('price');
    const sizeInput = document.getElementById('size');
    const buildYearInput = document.getElementById('buildYear');

    const exclusiveAreaField = document.getElementById('exclusiveAreaField');
    const grossAreaField = document.getElementById('grossAreaField');
    const landAreaField = document.getElementById('landAreaField');
    const landRightAreaField = document.getElementById('landRightAreaField');
    const floorField = document.getElementById('floorField');

    const exclusiveAreaInput = document.getElementById('exclusiveArea');
    const grossAreaInput = document.getElementById('grossArea');
    const landAreaInput = document.getElementById('landArea');
    const landRightAreaInput = document.getElementById('landRightArea');
    const floorInput = document.getElementById('floor');

    function updateFields() {
      const type = hiddenSelect.value;
      const deal = dealSelect.value;

      exclusiveAreaField.classList.add('hidden');
      grossAreaField.classList.add('hidden');
      landAreaField.classList.add('hidden');
      landRightAreaField.classList.add('hidden');
      floorField.classList.add('hidden');

      exclusiveAreaInput.required = false;
      grossAreaInput.required = false;
      landAreaInput.required = false;
      landRightAreaInput.required = false;
      floorInput.required = false;

      sizeField.classList.add('hidden');
      sizeInput.required = false;

      if (!type || !deal) return;

      if (type === 'house') {
        if (deal === 'sale') {
          grossAreaField.classList.remove('hidden');
          landAreaField.classList.remove('hidden');
          grossAreaInput.required = true;
          landAreaInput.required = true;
        } else if (deal === 'monthly' || deal === 'jeonse' || deal === 'yearly') {
          exclusiveAreaField.classList.remove('hidden');
          exclusiveAreaInput.required = true;
        }
      } else if (type === 'apartment') {
        exclusiveAreaField.classList.remove('hidden');
        floorField.classList.remove('hidden');
        exclusiveAreaInput.required = true;
        floorInput.required = true;
      } else if (type === 'villa') {
        if (deal === 'sale') {
          exclusiveAreaField.classList.remove('hidden');
          landRightAreaField.classList.remove('hidden');
          floorField.classList.remove('hidden');
          exclusiveAreaInput.required = true;
          landRightAreaInput.required = true;
          floorInput.required = true;
        } else {
          exclusiveAreaField.classList.remove('hidden');
          floorField.classList.remove('hidden');
          exclusiveAreaInput.required = true;
          floorInput.required = true;
        }
      } else if (type === 'officetel') {
        exclusiveAreaField.classList.remove('hidden');
        floorField.classList.remove('hidden');
        exclusiveAreaInput.required = true;
        floorInput.required = true;
      } else if (type === 'new') {
        if (deal !== 'sale') {
          setActiveDeal('sale');
          return;
        }
        exclusiveAreaField.classList.remove('hidden');
        floorField.classList.remove('hidden');
        exclusiveAreaInput.required = true;
        floorInput.required = true;
      }
    }

    function setActive(value) {
      segButtons.forEach((btn) => {
        const on = btn.dataset.value === value;
        btn.setAttribute('aria-checked', on ? 'true' : 'false');
        btn.tabIndex = on ? 0 : -1;
      });
      hiddenSelect.value = value || '';
      const show = !!value;
      priceField.classList.toggle('hidden', !show);
      sizeField.classList.toggle('hidden', !show);
      dealTypeField.classList.toggle('hidden', !show);
      yearField.classList.toggle('hidden', !show);
      priceInput.required = show;
      sizeInput.required = false;
      dealSelect.required = show;
      if (buildYearInput) buildYearInput.required = show;
      if (buildYearInput) buildYearInput.max = new Date().getFullYear();

      if (value === 'new' && dealSelect.value !== 'sale') {
        setActiveDeal('sale');
      } else {
        updateFields();
      }
    }

    function setActiveDeal(value) {
      dealButtons.forEach((btn) => {
        const on = btn.dataset.value === value;
        btn.setAttribute('aria-checked', on ? 'true' : 'false');
        btn.tabIndex = on ? 0 : -1;
      });
      dealSelect.value = value || '';
      updateFields();
    }

    setActive(hiddenSelect.value);
    setActiveDeal(dealSelect.value);

    segButtons.forEach((btn, idx) => {
      btn.addEventListener('click', () => {
        setActive(btn.dataset.value);
        btn.focus();
      });
      btn.addEventListener('keydown', (e) => {
        const keys = ['ArrowRight', 'ArrowDown', 'ArrowLeft', 'ArrowUp', 'Home', 'End', ' ', 'Enter'];
        if (!keys.includes(e.key)) return;
        e.preventDefault();
        let i = idx;
        if (e.key === 'ArrowRight' || e.key === 'ArrowDown') i = (idx + 1) % segButtons.length;
        if (e.key === 'ArrowLeft' || e.key === 'ArrowUp') i = (idx - 1 + segButtons.length) % segButtons.length;
        if (e.key === 'Home') i = 0;
        if (e.key === 'End') i = segButtons.length - 1;
        if (['ArrowRight', 'ArrowDown', 'ArrowLeft', 'ArrowUp', 'Home', 'End'].includes(e.key)) {
          const n = segButtons[i];
          setActive(n.dataset.value);
          n.focus();
        }
        if (e.key === ' ' || e.key === 'Enter') {
          setActive(btn.dataset.value);
        }
      });
    });

    dealButtons.forEach((btn, idx) => {
      btn.addEventListener('click', () => {
        setActiveDeal(btn.dataset.value);
        btn.focus();
      });
      btn.addEventListener('keydown', (e) => {
        const keys = ['ArrowRight', 'ArrowDown', 'ArrowLeft', 'ArrowUp', 'Home', 'End', ' ', 'Enter'];
        if (!keys.includes(e.key)) return;
        e.preventDefault();
        let i = idx;
        if (e.key === 'ArrowRight' || e.key === 'ArrowDown') i = (idx + 1) % dealButtons.length;
        if (e.key === 'ArrowLeft' || e.key === 'ArrowUp') i = (idx - 1 + dealButtons.length) % dealButtons.length;
        if (e.key === 'Home') i = 0;
        if (e.key === 'End') i = dealButtons.length - 1;
        if (['ArrowRight', 'ArrowDown', 'ArrowLeft', 'ArrowUp', 'Home', 'End'].includes(e.key)) {
          const n = dealButtons[i];
          setActiveDeal(n.dataset.value);
          n.focus();
        }
        if (e.key === ' ' || e.key === 'Enter') {
          setActiveDeal(btn.dataset.value);
        }
      });
    });

    const imagePicker = document.getElementById('imagePicker');
    imagePicker.addEventListener('change', async (e) => {
      const files = Array.from(e.target.files || []);
      for (const file of files) {
        if (!file.type.startsWith('image/')) continue;
        const dataUrl = await fileToDataURL(file);
        const range = quill.getSelection(true);
        const index = range ? range.index : quill.getLength();
        quill.insertEmbed(index, 'image', dataUrl, 'user');
        quill.setSelection(index + 1);
      }
      imagePicker.value = '';
    });

    function fileToDataURL(file) {
      return new Promise((resolve, reject) => {
        const reader = new FileReader();
        reader.onload = () => resolve(reader.result);
        reader.onerror = reject;
        reader.readAsDataURL(file);
      });
    }

    function handleSubmit(event) {
      event.preventDefault();
      const buildingName = document.getElementById('buildingName');
      if (!buildingName.value) {
        buildingName.focus();
        buildingName.closest('.field').scrollIntoView({ behavior: 'smooth', block: 'start' });
        return;
      }
      if (!hiddenSelect.value) {
        const group = document.getElementById('buildingType').closest('.field');
        group.scrollIntoView({ behavior: 'smooth', block: 'start' });
        segButtons[0].focus();
        return;
      }
      if (buildYearInput && yearField && !yearField.classList.contains('hidden') && !buildYearInput.value) {
        buildYearInput.focus();
        buildYearInput.closest('.field').scrollIntoView({ behavior: 'smooth', block: 'start' });
        return;
      }
      if (!dealSelect.value) {
        const group = document.getElementById('dealType').closest('.field');
        group.scrollIntoView({ behavior: 'smooth', block: 'start' });
        dealButtons[0].focus();
        return;
      }

      const type = hiddenSelect.value;
      const deal = dealSelect.value;

      if (type === 'house') {
        if (deal === 'sale') {
          if (!grossAreaInput.value) {
            grossAreaInput.focus();
            grossAreaInput.closest('.field').scrollIntoView({ behavior: 'smooth', block: 'start' });
            return;
          }
          if (!landAreaInput.value) {
            landAreaInput.focus();
            landAreaInput.closest('.field').scrollIntoView({ behavior: 'smooth', block: 'start' });
            return;
          }
        } else if (deal === 'monthly' || deal === 'jeonse' || deal === 'yearly') {
          if (!exclusiveAreaInput.value) {
            exclusiveAreaInput.focus();
            exclusiveAreaInput.closest('.field').scrollIntoView({ behavior: 'smooth', block: 'start' });
            return;
          }
        }
      } else if (type === 'apartment') {
        if (!exclusiveAreaInput.value) {
          exclusiveAreaInput.focus();
          exclusiveAreaInput.closest('.field').scrollIntoView({ behavior: 'smooth', block: 'start' });
          return;
        }
        if (!floorInput.value) {
          floorInput.focus();
          floorInput.closest('.field').scrollIntoView({ behavior: 'smooth', block: 'start' });
          return;
        }
      } else if (type === 'villa') {
        if (!exclusiveAreaInput.value) {
          exclusiveAreaInput.focus();
          exclusiveAreaInput.closest('.field').scrollIntoView({ behavior: 'smooth', block: 'start' });
          return;
        }
        if (deal === 'sale' && !landRightAreaInput.value) {
          landRightAreaInput.focus();
          landRightAreaInput.closest('.field').scrollIntoView({ behavior: 'smooth', block: 'start' });
          return;
        }
        if (!floorInput.value) {
          floorInput.focus();
          floorInput.closest('.field').scrollIntoView({ behavior: 'smooth', block: 'start' });
          return;
        }
      } else if (type === 'officetel') {
        if (!exclusiveAreaInput.value) {
          exclusiveAreaInput.focus();
          exclusiveAreaInput.closest('.field').scrollIntoView({ behavior: 'smooth', block: 'start' });
          return;
        }
        if (!floorInput.value) {
          floorInput.focus();
          floorInput.closest('.field').scrollIntoView({ behavior: 'smooth', block: 'start' });
          return;
        }
      } else if (type === 'new') {
        if (deal !== 'sale') {
          setActiveDeal('sale');
          return;
        }
        if (!exclusiveAreaInput.value) {
          exclusiveAreaInput.focus();
          exclusiveAreaInput.closest('.field').scrollIntoView({ behavior: 'smooth', block: 'start' });
          return;
        }
        if (!floorInput.value) {
          floorInput.focus();
          floorInput.closest('.field').scrollIntoView({ behavior: 'smooth', block: 'start' });
          return;
        }
      }

      if (!priceInput.value) {
        priceInput.focus();
        priceInput.closest('.field').scrollIntoView({ behavior: 'smooth', block: 'start' });
        return;
      }

      const html = quill.root.innerHTML.trim();
      if (!html || html === '<p><br></p>') {
        const group = document.getElementById('description').closest('.field');
        group.scrollIntoView({ behavior: 'smooth', block: 'start' });
        quill.focus();
        return;
      }

      document.getElementById('descriptionContent').value = html;

      const formData = {
        buildingName: buildingName.value,
        buildingType: type,
        buildYear: buildYearInput ? Number(buildYearInput.value) : undefined,
        dealType: deal,
        price: Number(priceInput.value),
        size: undefined,
        exclusiveArea: exclusiveAreaInput.value ? Number(exclusiveAreaInput.value) : undefined,
        grossArea: grossAreaInput.value ? Number(grossAreaInput.value) : undefined,
        landArea: landAreaInput.value ? Number(landAreaInput.value) : undefined,
        landRightArea: landRightAreaInput.value ? Number(landRightAreaInput.value) : undefined,
        floor: floorInput.value ? Number(floorInput.value) : undefined,
        descriptionContent: html
      };
      console.log('폼 제출됨:', formData);
      const btn = document.querySelector('.btn primary');
      const t = btn.textContent;
      btn.textContent = '등록 완료!';
      setTimeout(() => {
        btn.textContent = t;
      }, 1200);
    }

    function resetForm() {
      quill.setContents([]);
      document.getElementById('descriptionContent').value = '';
      hiddenSelect.value = '';
      dealSelect.value = '';
      setActive('');
      setActiveDeal('');
      imagePicker.value = '';
      priceInput.value = '';
      sizeInput.value = '';
      if (buildYearInput) buildYearInput.value = '';
      if (yearField) yearField.classList.add('hidden');
      priceField.classList.add('hidden');
      sizeField.classList.add('hidden');
      dealTypeField.classList.add('hidden');
      priceInput.required = false;
      sizeInput.required = false;
      dealSelect.required = false;
      if (buildYearInput) buildYearInput.required = false;

      exclusiveAreaInput.value = '';
      grossAreaInput.value = '';
      landAreaInput.value = '';
      landRightAreaInput.value = '';
      floorInput.value = '';

      exclusiveAreaField.classList.add('hidden');
      grossAreaField.classList.add('hidden');
      landAreaField.classList.add('hidden');
      landRightAreaField.classList.add('hidden');
      floorField.classList.add('hidden');

      exclusiveAreaInput.required = false;
      grossAreaInput.required = false;
      landAreaInput.required = false;
      landRightAreaInput.required = false;
      floorInput.required = false;
    }
  </script>
</body>
</html>
